package com.joyent.manta.benchmark;

import org.apache.commons.lang3.RandomUtils;

import java.io.IOException;
import java.io.InputStream;

/**
 * {@link InputStream} implementation that generates random data.
 *
 * @author <a href="https://github.com/dekobon">Elijah Zupancic</a>
 */
public class RandomInputStream extends InputStream {
    /**
     * End of file magic number.
     */
    private static final int EOF = -1;

    /**
     * Maximum number of bytes to generate.
     */
    private final long maximumBytes;

    /**
     * Current generated byte count.
     */
    private volatile long count;

    /**
     * Creates a new instance.
     * @param maximumBytes maximum number of random bytes in stream
     */
    public RandomInputStream(final long maximumBytes) {
        this.maximumBytes = maximumBytes;
    }

    @Override
    public int read() throws IOException {
        if (count > maximumBytes) {
            return EOF;
        }
        count++;

        return RandomUtils.nextInt(0, Integer.MAX_VALUE);
    }
}
